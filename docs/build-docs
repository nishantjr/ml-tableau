#!/usr/bin/env bash

set -eu -o pipefail
REPO_DIR="$(cd $(dirname $0)/..; pwd)"
DOC_DIR="$REPO_DIR/docs"
BUILD_DIR="$REPO_DIR/.build"

cd "$DOC_DIR"

mkdir -p "$BUILD_DIR"
pandoc --standalone -t latex -o "$BUILD_DIR/tableau.pdf" \
       "$DOC_DIR"/introduction.md \
       "$DOC_DIR"/preliminaries.md \
       "$DOC_DIR"/modal-matching-logic.md \
       "$DOC_DIR"/game-preliminaries.md \
       "$DOC_DIR"/qf-matching-logic.md \
       "$DOC_DIR"/tableau.md \
       "$DOC_DIR"/appendix.md \
       --pdf-engine=xelatex \
       --template="$DOC_DIR/template.tex" \
       -F pandoc-crossref \
       --citeproc --bibliography "$DOC_DIR"/refs.bib \
       --table-of-contents \
       -F pandocfilters/defenv.py
